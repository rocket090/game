<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; img-src data:; connect-src 'self'">
    <title>Solo</title>
<style>
        body { font-family: 'Arial', sans-serif; text-align: center; background-color: #f4f4f4; color: #333; }
        h1 { color: #222; }
        .game-container { background: white; padding: 30px; margin: 20px auto; width: 80%; max-width: 515px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .number-buttons button, .action-buttons button { margin: 3px; padding: 10px; font-size: 16px; width: 41px; height: 40px; border: none; border-radius: 5px; cursor: pointer; background: #cccccc; color: black; }
        .number-buttons .disabled, .action-buttons .disabled { background-color: #999; pointer-events: none; }
        .action-buttons button { width: 90px; }
        .reset-button { background: #666; }
        .history-container { text-align: left; margin-top: 20px; }
        ul { list-style: none; padding: 0; }
        .history-entry { display: flex; align-items: center; background: #ccc; padding: 10px; margin: 5px; border-radius: 5px; }
        .history-index { background: #888; color: white; width: 30px; height: 30px; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .history-text { margin-left: 10px; }
        .action-result { margin-top: 10px; padding: 10px; background-color: #e0e0e0; border-radius: 5px; display: none; }
        .history-entry.correct {    background-color: #ffe0e0;}
        .history-entry.correct .history-index {background-color: red;    color: white;}
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Number Game - Solo</h1>
        <p>3桁の異なる数字を入力してください。<a href="https://ja.wikipedia.org/wiki/Numer0n#%E3%83%AB%E3%83%BC%E3%83%AB">ルール</a></p>
        <div class="number-buttons">
            <button onclick="toggleDigit(0)" id="btn0">0</button>
            <button onclick="toggleDigit(1)" id="btn1">1</button>
            <button onclick="toggleDigit(2)" id="btn2">2</button>
            <button onclick="toggleDigit(3)" id="btn3">3</button>
            <button onclick="toggleDigit(4)" id="btn4">4</button>
            <button onclick="toggleDigit(5)" id="btn5">5</button>
            <button onclick="toggleDigit(6)" id="btn6">6</button>
            <button onclick="toggleDigit(7)" id="btn7">7</button>
            <button onclick="toggleDigit(8)" id="btn8">8</button>
            <button onclick="toggleDigit(9)" id="btn9">9</button>
        </div>
        <p>入力: <span id="guess"></span></p>
        <p>試行回数: <span id="attempt-count">0</span></p>
        <p id="action-result-message"></p>
        <div class="action-buttons">
            <button onclick="highLow()" id="highLowBtn">High&Low</button>
            <button onclick="target()" id="targetBtn">Target</button>
            <button onclick="slash()" id="slashBtn" style="margin-right: 15px;">Slash</button>
            <button onclick="checkGuess()" style="background-color: lightblue;">Try</button>
            <button onclick="resetInput()" class="reset-button">Reset</button>
        </div>
        <div class="history-container">
            <h2 style="margin-left: 5px;">履歴</h2>
            <ul id="history"></ul>
        </div>
        <div class="action-buttons">
        <button onclick="resetGame()" id="play-again" style="display: none; width: auto;">もう一度プレイ</button>
    </div>
    </div>
    <p><a href="ai.html" style="color: darkgray;">AI-Mode</a></p>


    <script>
        let secretNumber = generateNumber();
        let currentGuess = "";
        let attemptCount = 0;
        let targetDigit = null;
        let highLowResult = false;
        let slashResult = null;
        let isTargetUsed = false;

        function generateNumber() {
            let digits = new Set();
            while (digits.size < 3) {
                digits.add(Math.floor(Math.random() * 10));
            }
            return Array.from(digits).join('');
        }

        function toggleDigit(digit) {
            let index = currentGuess.indexOf(digit.toString());
            if (index !== -1) {
                currentGuess = currentGuess.slice(0, index) + currentGuess.slice(index + 1);
                document.getElementById('btn' + digit).classList.remove('disabled');
            } else if (currentGuess.length < 3) {
                currentGuess += digit;
                document.getElementById('btn' + digit).classList.add('disabled');
            }
            document.getElementById('guess').innerText = currentGuess;
        }

        function resetInput() {
            currentGuess = "";
            document.getElementById('guess').innerText = currentGuess;
            for (let i = 0; i <= 9; i++) {
                document.getElementById('btn' + i).classList.remove('disabled');
                document.getElementById('btn' + i).onclick = function() { toggleDigit(i); };
            }
            document.getElementById('action-result-message').innerText = '';
        }

        function resetGame() {
            // ゲームの変数をリセット
            secretNumber = generateNumber();
            currentGuess = "";
            attemptCount = 0;
            targetDigit = null;
            highLowResult = false;
            slashResult = null;
            isTargetUsed = false;

            // UIをリセット
            document.getElementById('attempt-count').innerText = attemptCount;
            document.getElementById('history').innerHTML = '';  // 履歴をクリア
            document.getElementById('action-result-message').innerText = '';
            document.getElementById('play-again').style.display = 'none';  // もう一度プレイボタンを隠す

            // ボタンの状態をリセット
            resetInput();
            document.getElementById('highLowBtn').classList.remove('disabled');
            document.getElementById('targetBtn').classList.remove('disabled');
            document.getElementById('slashBtn').classList.remove('disabled');
        }

        function checkGuess() {
            if (currentGuess.length !== 3) {
                return;
            }
            attemptCount++;
            document.getElementById('attempt-count').innerText = attemptCount;
            let eat = 0, bite = 0;
            for (let i = 0; i < 3; i++) {
                if (currentGuess[i] === secretNumber[i]) {
                    eat++;
                } else if (secretNumber.includes(currentGuess[i])) {
                    bite++;
                }
            }
            let historyList = document.getElementById('history');
            let historyItem = document.createElement('li');
            historyItem.classList.add('history-entry');
            
            let indexBox = document.createElement('div');
            indexBox.classList.add('history-index');
            indexBox.innerText = attemptCount;
            
            let textBox = document.createElement('div');
            textBox.classList.add('history-text');
            textBox.innerText = `${currentGuess} : ${eat}EAT ${bite}BITE`;
            
            historyItem.appendChild(indexBox);
            historyItem.appendChild(textBox);
            historyList.appendChild(historyItem);
            
            if (eat === 3) {
                historyItem.classList.add('correct');
                indexBox.classList.add('correct-index');
                textBox.innerHTML = `${currentGuess} : <span style="color: red; font-weight: bold;">${eat}EAT</span> ${bite}BITE`;
                document.getElementById('play-again').style.display = 'block';
            }
            resetInput();
        }

        function highLow() {
            attemptCount++;
            let result = "";
            for (let i = 0; i < 3; i++) {
                result += secretNumber[i] < 5 ? '[LOW]' : '[HIGH]';
            }
            recordAction("HIGH & LOW", result);
            document.getElementById('highLowBtn').classList.add('disabled');
        }

        function target() {
            attemptCount++;
            let targetMessage = "";
            isTargetUsed = true;
            document.getElementById('action-result-message').innerText = "TARGET: 数字を選んでください。";
            document.querySelectorAll('.number-buttons button').forEach(button => {
                button.onclick = function() {
                    targetDigit = parseInt(button.innerText);
                    if (secretNumber.includes(targetDigit.toString())) {
                        targetMessage = `TARGET(${targetDigit}): 含まれている`;
                    } else {
                        targetMessage = `TARGET(${targetDigit}): 含まれていない`;
                    }
                    recordAction("TARGET", targetMessage);
                    document.querySelectorAll('.number-buttons button').forEach(btn => btn.onclick = null);  // 数字ボタンのリセット
                    document.getElementById('targetBtn').classList.add('disabled');
                    // 数字入力の復帰
                    setTimeout(() => {
                        resetInput(); // 入力をリセットし、再度数字ボタンが有効化される
                    }, 500);
                }
            });
        }

        function slash() {
            attemptCount++;
            let digits = secretNumber.split('');
            let maxDigit = Math.max(...digits);
            let minDigit = Math.min(...digits);
            let result = maxDigit - minDigit;
            recordAction("SLASH", `SLASH: ${result}`);
            document.getElementById('slashBtn').classList.add('disabled');
        }

        function recordAction(actionName, result) {
            let historyList = document.getElementById('history');
            let historyItem = document.createElement('li');
            historyItem.classList.add('history-entry');
            
            let indexBox = document.createElement('div');
            indexBox.classList.add('history-index');
            indexBox.innerText = attemptCount;
            
            let textBox = document.createElement('div');
            textBox.classList.add('history-text');
            textBox.innerText = `${result}`;
            
            historyItem.appendChild(indexBox);
            historyItem.appendChild(textBox);
            historyList.appendChild(historyItem);
        }

    </script>
</body>
</html>
